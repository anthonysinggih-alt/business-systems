<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Production Schedule</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; }
    .table td, .table th { vertical-align: middle; }
  </style>
</head>
<body>
<div class="container">

  <a href="{{ url_for('index') }}" class="btn btn-secondary btn-sm mb-3">â¬… Back</a>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h2 class="mb-3">ðŸ§¾ Schedule New Production</h2>

  <form method="POST" class="row g-2 mb-4">
    <input type="hidden" name="form_type" value="add_task">
    <div class="col-md-4">
      <select class="form-select" name="component_sku" required>
        <option value="">-- Select Component --</option>
        {% for c in components %}
        <option value="{{ c.sku }}">{{ c.sku }} â€” {{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <input class="form-control" name="qty" type="number" min="1" value="1" placeholder="Quantity">
    </div>
    <div class="col-md-3">
      <button class="btn btn-primary w-100">âž• Add Task</button>
    </div>
  </form>

  <h3 class="mb-3">ðŸ“‹ Current Production Tasks</h3>

<table class="table table-bordered table-hover align-middle">
  <thead class="table-dark text-center">
    <tr>
      <th>ID</th>
      <th>Component</th>
      <th>Quantity</th>
      <th>Lead Time (Hours)</th>
      <th>Status</th>
      <th>Created At</th>
      <th>Estimated Completion</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
      {% set row_class = "" %}
      {% if task.status == "completed" %}
        {% set row_class = "table-success" %}
      {% elif task.status == "cancelled" %}
        {% set row_class = "table-secondary" %}
      {% elif task.is_overdue %}
        {% set row_class = "table-danger" %}
      {% endif %}

      <tr class="{{ row_class }}">
        <td class="text-center">{{ task.id }}</td>
        <td>
          <strong>{{ task.component_name }}</strong><br>
          <small class="text-muted">{{ task.component_sku }}</small>
        </td>
        <td class="text-center">{{ task.quantity }}</td>
        <td class="text-center">{{ task.lead_time }}</td>
        <td class="text-center text-capitalize">{{ task.status }}</td>
        <td class="text-center">{{ task.created_at }}</td>
        <td class="text-center">{{ task.estimated_completion }}</td>
        <td class="text-center">
          {% if task.status == 'pending' %}
          <form method="POST" style="display:inline;">
            <input type="hidden" name="form_type" value="update_task">
            <input type="hidden" name="task_id" value="{{ task.id }}">
            <button name="action" value="complete" class="btn btn-success btn-sm">âœ… Complete</button>
            <button name="action" value="cancel" class="btn btn-outline-danger btn-sm"
              onclick="return confirm('Delete this task?');">ðŸ—‘ Delete</button>
          </form>
          {% else %}
          <em class="text-muted">{{ task.status }}</em>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>


</div>
</body>
</html>
